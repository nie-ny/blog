<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>å­¦ä¹ </title>
  </head>
  <body>
    <canvas id="c2d" class="c2d" width="1000" height="500"></canvas>
    <input id="but" type="button" value="1" />
    <script type="module">
      import * as THREE from 'https://threejsfundamentals.org/threejs/resources/threejs/r132/build/three.module.js'
      import { OrbitControls } from 'https://threejsfundamentals.org/threejs/resources/threejs/r132/examples/jsm/controls/OrbitControls.js'
      import { GLTFLoader } from 'https://threejsfundamentals.org/threejs/resources/threejs/r132/examples/jsm/loaders/GLTFLoader.js'

      const canvas = document.querySelector('#c2d')
      // æ¸²æŸ“å™¨
      const renderer = new THREE.WebGLRenderer({ canvas })

      const fov = 40 // è§†é‡èŒƒå›´
      const aspect = 2 // ç›¸æœºé»˜è®¤å€¼ ç”»å¸ƒçš„å®½é«˜æ¯”
      const near = 0.1 // è¿‘å¹³é¢
      const far = 10000 // è¿œå¹³é¢
      // é€è§†æŠ•å½±ç›¸æœº
      const camera = new THREE.PerspectiveCamera(fov, aspect, near, far)

      // ç›¸æœºä½ç½®  æ­£ä¸Šæ–¹å‘ä¸‹çœ‹
      camera.position.set(200, 400, 300)
      // camera.up.set(0, 0, 1)
      camera.lookAt(0, 0, 0)

      const controls = new OrbitControls(camera, canvas)
      controls.update()

      // åˆ›å»ºåœºæ™¯
      const scene = new THREE.Scene()

      {
        const skyColor = 0xb1e1ff // light blue
        const groundColor = 0xb97a20 // brownish orange
        const intensity = 1
        const light = new THREE.HemisphereLight(skyColor, groundColor, intensity)
        scene.add(light)
      }

      {
        const color = 0xffffff
        const intensity = 1
        const light = new THREE.DirectionalLight(color, intensity)
        light.position.set(5, 10, 2)
        scene.add(light)
        scene.add(light.target)
      }
      //

      //è½¦èº«é¢œè‰²æ•°ç»„
      const colorAry = [
        'rgb(216, 27, 67)',
        'rgb(142, 36, 170)',
        'rgb(81, 45, 168)',
        'rgb(48, 63, 159)',
        'rgb(30, 136, 229)',
        'rgb(0, 137, 123)',
        'rgb(67, 160, 71)',
        'rgb(251, 192, 45)',
        'rgb(245, 124, 0)',
        'rgb(230, 74, 25)',
        'rgb(233, 30, 78)',
        'rgb(156, 39, 176)',
        'rgb(0, 0, 0)'
      ] // è½¦èº«é¢œè‰²æ•°ç»„
      const loader = new GLTFLoader() //å¼•å…¥æ¨¡å‹çš„loaderå®ä¾‹

      loader.load(
        './scene.gltf',
        (gltf) => {
          // console.log('ğŸš€ ~ file: index.html ~ line 65 ~ gltf', gltf)

          scene.add(gltf.scene)
        },
        ({ loaded, total }) => {
          let load = Math.abs((loaded / total) * 100)
          console.log((loaded / total) * 100 + '% loaded')
        },
        (err) => {
          console.log('ğŸš€ ~ file: index.html ~ line 78 ~ err', err)
        }
      )

      function modify(index) {
        const currentColor = new THREE.Color(colorAry[index])

        // traverse éå† æ‰€æœ‰å¯¹è±¡
        scene.traverse((child) => {
          // console.log('ğŸš€ ~ file: index.html ~ line 81 ~ scene.traverse ~ child', child, child.isMesh)
          if (child.isMesh) {
            // æ˜¯å¦æè´¨
            console.log(child.name)
            child.material.color.set(currentColor)
          }
        })
      }

      document.getElementById('but').onclick = (e) => {
        // console.log('ğŸš€ ~ file: index.html ~ line 104 ~ document.getElementById ~ e', e.target.value)
        modify(e.target.value)
      }

      //
      function render(time) {
        const index = (time * 10) % 13

        if (resizeRendererToDisplaySize(renderer)) {
          // ç”»å¸ƒå¤§å°ä¿®æ”¹å è°ƒæ•´ æ¯”ä¾‹
          const canvas = renderer.domElement
          camera.aspect = canvas.clientWidth / canvas.clientHeight
          camera.updateProjectionMatrix()
        }

        // åŠ è½½æ¸²æŸ“å™¨
        renderer.render(scene, camera)

        // å¼€å§‹åŠ¨ç”»
        requestAnimationFrame(render)
      }

      // æ¸²æŸ“å™¨ é‡æ–°è°ƒæ•´
      function resizeRendererToDisplaySize(renderer) {
        const canvas = renderer.domElement
        const width = canvas.clientWidth
        const height = canvas.clientHeight
        const needResize = canvas.width !== width || canvas.height !== height
        if (needResize) {
          renderer.setSize(width, height, false)
        }
        return needResize
      }

      // å¼€å§‹æ¸²æŸ“
      requestAnimationFrame(render)
    </script>
  </body>
</html>
