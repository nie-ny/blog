<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>å­¦ä¹ </title>
  </head>
  <body>
    <canvas id="c2d" class="c2d" width="1000" height="500"></canvas>
    <script type="module">
      /*
       * æ¨¡æ‹Ÿåœ°çƒ è¿åŠ¨
       */
      import * as THREE from 'https://threejsfundamentals.org/threejs/resources/threejs/r132/build/three.module.js'

      const canvas = document.querySelector('#c2d')
      // æ¸²æŸ“å™¨
      const renderer = new THREE.WebGLRenderer({ canvas })

      const fov = 40 // è§†é‡ŽèŒƒå›´
      const aspect = 2 // ç›¸æœºé»˜è®¤å€¼ ç”»å¸ƒçš„å®½é«˜æ¯”
      const near = 0.1 // è¿‘å¹³é¢
      const far = 1000 // è¿œå¹³é¢
      // é€è§†æŠ•å½±ç›¸æœº
      const camera = new THREE.PerspectiveCamera(fov, aspect, near, far)
      console.log('ðŸš€ ~ file: threeTest.html ~ line 25 ~ camera', camera)

      // ç›¸æœºä½ç½®  æ­£ä¸Šæ–¹å‘ä¸‹çœ‹
      camera.position.set(0, 50, 0)
      camera.up.set(0, 0, 1)
      camera.lookAt(0, 0, 0)

      // åˆ›å»ºåœºæ™¯
      const scene = new THREE.Scene()

      const color = 0xffffff
      const intensity = 3
      // åˆ›å»ºå…‰æº
      const light = new THREE.PointLight(color, intensity)
      // å…‰æº åŠ å…¥åœºæ™¯
      scene.add(light)

      // å…¬ç”¨çƒä½“
      const radius = 1 // åŠå¾„
      const widthSegments = 6 // ç»åº¦ä¸Šçš„åˆ‡ç‰‡æ•°
      const heightSegments = 6 // çº¬åº¦ä¸Šçš„åˆ‡ç‰‡æ•°
      // åˆ›å»ºçƒä½“
      const sphereGeometry = new THREE.SphereGeometry(radius, widthSegments, heightSegments)

      // å¤ªé˜³ç³» å±€éƒ¨æ¨¡åž‹
      const solarSystem = new THREE.Object3D()
      scene.add(solarSystem)

      // æè´¨ emissive ä¸è¢«å…‰å½±å“çš„é¢œè‰²
      const sunMaterial = new THREE.MeshPhongMaterial({ emissive: 0xffff00 })
      // æ¨¡åž‹
      const sunMesh = new THREE.Mesh(sphereGeometry, sunMaterial)
      // æ”¾å¤§æ¨¡åž‹
      sunMesh.scale.set(5, 5, 5)
      // æ¨¡åž‹ åŠ å…¥åœºæ™¯
      // scene.add(sunMesh)
      solarSystem.add(sunMesh)

      // åœ°çƒç³» å±€éƒ¨æ¨¡åž‹
      const earthSystem = new THREE.Object3D()
      earthSystem.position.x = 10
      solarSystem.add(earthSystem)

      // æè´¨
      const earthMaterial = new THREE.MeshPhongMaterial({
        color: 0x2233ff,
        emissive: 0x112244
      })
      const earthMesh = new THREE.Mesh(sphereGeometry, earthMaterial)
      // earthMesh.position.x = 10
      // scene.add(earthMesh)
      // sunMesh.add(earthMesh)
      // solarSystem.add(earthMesh)
      earthSystem.add(earthMesh)

      // æœˆçƒç³» å±€éƒ¨æ¨¡åž‹
      const moonSystem = new THREE.Object3D()
      moonSystem.position.x = 2
      earthSystem.add(moonSystem)

      // æè´¨
      const moonMaterial = new THREE.MeshPhongMaterial({ color: 0x888888, emissive: 0x222222 })
      // æ¨¡åž‹
      const moonMesh = new THREE.Mesh(sphereGeometry, moonMaterial)
      moonMesh.scale.set(0.5, 0.5, 0.5)
      moonSystem.add(moonMesh)

      // è¦æ›´æ–°æ—‹è½¬è§’åº¦çš„å¯¹è±¡æ•°ç»„
      const objects = []
      objects.push(solarSystem)
      // objects.push(sunMesh)
      objects.push(earthSystem)
      // objects.push(earthMesh)
      objects.push(moonSystem)
      // objects.push(moonMesh)

      // æ¸²æŸ“å™¨ é‡æ–°è°ƒæ•´
      function resizeRendererToDisplaySize(renderer) {
        const canvas = renderer.domElement
        const width = canvas.clientWidth
        const height = canvas.clientHeight
        const needResize = canvas.width !== width || canvas.height !== height
        if (needResize) {
          renderer.setSize(width, height, false)
        }
        return needResize
      }

      //
      function render(time) {
        time *= 0.001

        if (resizeRendererToDisplaySize(renderer)) {
          // ç”»å¸ƒå¤§å°ä¿®æ”¹åŽ è°ƒæ•´ æ¯”ä¾‹
          const canvas = renderer.domElement
          camera.aspect = canvas.clientWidth / canvas.clientHeight
          camera.updateProjectionMatrix()
        }

        // ä¿®æ”¹æ¨¡åž‹
        objects.forEach((obj) => {
          // ä¿®æ”¹ y è§’åº¦
          obj.rotation.y = time
        })

        // åŠ è½½æ¸²æŸ“å™¨
        renderer.render(scene, camera)

        // å¼€å§‹åŠ¨ç”»
        requestAnimationFrame(render)
      }

      // å¼€å§‹æ¸²æŸ“
      requestAnimationFrame(render)
    </script>
  </body>
</html>
